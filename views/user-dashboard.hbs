<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>

    <!-- Navigation -->
    <header class="header">
        <nav class="nav">
            <a href="/user/dashboard" class="nav-brand">KickNHit</a>
            
            <!-- Center navigation links -->
            <div class="nav-center">
                <div class="nav-links">
                    <a href="#products" class="nav-link">üì¶ PRODUCTS</a>
                    <a href="#cart" class="nav-link">
                        üõí CART
                        <span id="cart-count" class="cart-count">0</span>
                    </a>
                </div>
            </div>

            <div class="nav-user">
                <!-- Search Bar -->
                <div class="nav-search">
                    <input id="product-search" type="text" class="search-input" placeholder="Search products..." autocomplete="off">
                    <span class="search-icon">
                        <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    </span>
                    <div id="search-suggestions" class="search-suggestions"></div>
                </div>
                
                <!-- Welcome Message -->
                <span class="nav-user-info">WELCOME : <strong>{{user.firstName}}</strong></span>
                
                <!-- Logout Button -->
                <form action="/logout" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-outline btn-sm">
                        LOGOUT
                    </button>
                </form>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="user-hero">
        <div class="user-hero-content">
            <!-- Text Content -->
            <div class="user-hero-text">
                <h1 class="user-hero-title">
                    Welcome To Your Sports Store -
                    <span class="user-hero-highlight">{{user.firstName}}!</span>
                </h1>
                <p class="user-hero-subtitle">
                    Discover premium cricket and football equipment with exclusive deals.
                </p>
                <p class="user-hero-description">
                    Simply click <span class="font-semibold"><b>" Add To Cart "</b></span> on any item you like.<br>
                    Track your selections in the cart and checkout when ready!
                </p>
            </div>

            <!-- Image Crossfade Carousel for User Dashboard -->
            <div class="user-hero-image">
                <div class="hero-carousel">
                    <img id="img1"
                        src="https://www.primeparc.in/assets/img/slider/1.jpg"
                        alt="Sports Equipment Store"
                        style="opacity: 1; z-index: 10;"
                    />
                    <img id="img2"
                        src=""
                        alt="Sports Equipment"
                        style="opacity: 0; z-index: 0;"
                    />
                </div>
            </div>
        </div>
    </section>    <script>
        // Hero carousel logic for user dashboard
        const images = [
            "https://www.primeparc.in/assets/img/slider/1.jpg",
            "https://thumbs.dreamstime.com/b/rainy-night-cricket-scene-wet-cricket-field-captures-essence-rainy-night-game-droplets-glisten-creating-dramatic-366031417.jpg",
            "https://breakingglobe.com/wp-content/uploads/2024/08/DALL%C2%B7E-2024-08-16-02.23.54-A-dynamic-and-vibrant-image-depicting-the-excitement-of-both-cricket-and-football.-On-the-left-show-a-cricket-batsman-in-mid-swing-with-a-bowler-del.webp"
        ];

        let current = 0;
        const img1 = document.getElementById("img1");
        const img2 = document.getElementById("img2");

        setInterval(() => {
            const next = (current + 1) % images.length;

            if (img1.style.opacity === "1") {
                img2.src = images[next];
                img2.style.opacity = "1";
                img2.style.zIndex = "10";
                img1.style.opacity = "0";
                img1.style.zIndex = "0";
            } else {
                img1.src = images[next];
                img1.style.opacity = "1";
                img1.style.zIndex = "10";
                img2.style.opacity = "0";
                img2.style.zIndex = "0";
            }

            current = next;
        }, 2000);
    </script>


    <!-- Statistics Section -->
    <section class="stats">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">10K+</div>
                    <div class="stat-label">Happy Customers</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">500+</div>
                    <div class="stat-label">Products</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">50+</div>
                    <div class="stat-label">Brands</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">24/7</div>
                    <div class="stat-label">Support</div>
                </div>
            </div>
        </div>
    </section>


    <!-- Product Categories Section -->
    <section id="products" class="section">
        <div class="container">
            <div class="text-center mb-4">
                <h2 class="section-title">Shop by Category</h2>
                <p class="section-description">Find exactly what you need for your sport. Browse our extensive collection of professional-grade cricket and football equipment, designed for players at every level.</p>
            </div>

            <!-- Category Tabs -->
            <div class="category-tabs">
                <div class="category-tab-container">
                    <button onclick="showCategory('cricket')" id="cricket-tab" class="category-tab active">
                        üèè Cricket
                    </button>
                    <button onclick="showCategory('football')" id="football-tab" class="category-tab">
                        ‚öΩ Football
                    </button>
                </div>
            </div>

            <!-- Cricket Products -->
            <div id="cricket-products" class="product-category">
                <!-- Carousel view (when more than 3 products) -->
                <div id="cricket-carousel" class="hidden">
                    <div class="carousel-controls">
                        <h3 class="product-category-title">Cricket Products</h3>
                        <div class="carousel-nav">
                            <button onclick="scrollCarousel('cricket-carousel-items', -1)" class="carousel-btn">
                                ‚Üê
                            </button>
                            <button onclick="scrollCarousel('cricket-carousel-items', 1)" class="carousel-btn">
                                ‚Üí
                            </button>
                        </div>
                    </div>
                    <div class="product-carousel" id="cricket-carousel-items">
                        <!-- Products will appear here when in carousel mode -->
                    </div>
                </div>
                
                <!-- Grid view (when 3 or fewer products) -->
                <div id="cricket-grid" class="product-grid">
                    <!-- Products will be loaded dynamically from API -->
                </div>
            </div>

            <!-- Football Products -->
            <div id="football-products" class="product-category hidden">
                <!-- Carousel view (when more than 3 products) -->
                <div id="football-carousel" class="hidden">
                    <div class="carousel-controls">
                        <h3 class="product-category-title">Football Products</h3>
                        <div class="carousel-nav">
                            <button onclick="scrollCarousel('football-carousel-items', -1)" class="carousel-btn">
                                ‚Üê
                            </button>
                            <button onclick="scrollCarousel('football-carousel-items', 1)" class="carousel-btn">
                                ‚Üí
                            </button>
                        </div>
                    </div>
                    <div class="product-carousel" id="football-carousel-items">
                        <!-- Products will appear here when in carousel mode -->
                    </div>
                </div>
                
                <!-- Grid view (when 3 or fewer products) -->
                <div id="football-grid" class="product-grid">
                    <!-- Products will be loaded dynamically from API -->
                </div>
            </div>
        </div>
    </section>

    <!-- Featured Products Section -->
    <section id="featured" class="section">
        <div class="container">
            <div class="text-center mb-4">
                <h2 class="section-title">Featured Products</h2>
                <p class="section-description">Hand-picked favorites loved by professionals</p>
            </div>

            <div class="product-grid">
                <!-- Featured Cricket Bat -->
                <div class="card featured-card" data-product-id="featured-bat">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://admin.thecricketer.com/weblab/sites/96c8b790-b593-bfda-0ba4-ecd3a9fdefc2/resources/images/site/kookaburra_nickel_4.1.jpg"
                            alt="Professional Cricket Bat" class="card-img">
                        <div class="featured-badge">FEATURED</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Professional Cricket Bat Pro</h3>
                        <p class="card-description">Premium English willow, used by international players</p>
                        <div class="card-footer">
                            <span class="card-price">‚Çπ4,999</span>
                            <button onclick="addToCart('featured-bat', 'Professional Cricket Bat Pro', 4999)" class="btn btn-primary btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Featured Football Boots -->
                <div class="card featured-card" data-product-id="featured-boots">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://preview.free3d.com/img/2010/06/1871863703398254318/o29lvvye.jpg"
                            alt="Professional Football Boots" class="card-img">
                        <div class="featured-badge">FEATURED</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Elite Football Boots</h3>
                        <p class="card-description">Professional grade boots with advanced grip technology</p>
                        <div class="card-footer">
                            <span class="card-price">‚Çπ5,999</span>
                            <button onclick="addToCart('featured-boots', 'Elite Football Boots', 5999)" class="btn btn-primary btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Featured Kit -->
                <div class="card featured-card" data-product-id="featured-kit">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://5.imimg.com/data5/SELLER/Default/2024/6/424095483/DF/VP/RY/163043379/whatsapp-image-2024-06-01-at-3-26-20-pm-500x500.jpeg"
                            alt="Complete Cricket Kit" class="card-img">
                        <div class="featured-badge">FEATURED</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Complete Cricket Kit</h3>
                        <p class="card-description">Everything you need: bat, pads, gloves, helmet</p>
                        <div class="card-footer">
                            <span class="card-price">‚Çπ8,999</span>
                            <button onclick="addToCart('featured-kit', 'Complete Cricket Kit', 8999)" class="btn btn-primary btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Sale Section -->
    <section id="sale" class="sale-section">
        <div class="container">
            <div class="text-center mb-4">
                <h2 class="section-title">Flash Sale - Limited Time!</h2>
                <p class="section-description">Up to 40% off on selected items</p>
            </div>

            <div class="flash-sale-grid">
                <!-- Sale Item 1 -->
                <div class="card sale-card" data-product-id="sale-pads">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://a2cricket.com/cdn/shop/files/A2Cricket-CricketBattingPads_7_1400x.jpg?v=1690984808"
                            alt="Cricket Pads" class="card-img">
                        <div class="sale-badge">40% OFF</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Cricket Batting Pads</h3>
                        <div class="card-footer">
                            <div class="sale-price">
                                <span class="sale-price-main">‚Çπ1,199</span>
                                <span class="original-price">‚Çπ1,999</span>
                            </div>
                            <button onclick="addToCart('sale-pads', 'Cricket Batting Pads', 1199)" class="btn btn-danger btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sale Item 2 -->
                <div class="card sale-card" data-product-id="sale-football">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://contents.mediadecathlon.com/p2571328/bcd3c25846279cde8d74b9996aef2566/p2571328.jpg?format=auto&quality=70&f=2520x0"
                            alt="Football" class="card-img">
                        <div class="sale-badge">35% OFF</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Professional Football</h3>
                        <div class="card-footer">
                            <div class="sale-price">
                                <span class="sale-price-main">‚Çπ1,299</span>
                                <span class="original-price">‚Çπ1,999</span>
                            </div>
                            <button onclick="addToCart('sale-football', 'Professional Football', 1299)" class="btn btn-danger btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sale Item 3 -->
                <div class="card sale-card" data-product-id="sale-gloves">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://sportsgoodsmarket.com/wp-content/uploads/2020/12/PRO-5-scaled.jpg"
                            alt="Cricket Gloves" class="card-img">
                        <div class="sale-badge">30% OFF</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Cricket Batting Gloves</h3>
                        <div class="card-footer">
                            <div class="sale-price">
                                <span class="sale-price-main">‚Çπ629</span>
                                <span class="original-price">‚Çπ899</span>
                            </div>
                            <button onclick="addToCart('sale-gloves', 'Cricket Batting Gloves', 629)" class="btn btn-danger btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Sale Item 4 -->
                <div class="card sale-card" data-product-id="sale-helmet">
                    <div class="card-img-container" style="position: relative;">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTFFjrb83_2blLq98U-oonOUB3NSU5JaX3-Dw&s"
                            alt="Cricket Helmet" class="card-img">
                        <div class="sale-badge">25% OFF</div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">Cricket Helmet</h3>
                        <div class="card-footer">
                            <div class="sale-price">
                                <span class="sale-price-main">‚Çπ974</span>
                                <span class="original-price">‚Çπ1,299</span>
                            </div>
                            <button onclick="addToCart('sale-helmet', 'Cricket Helmet', 974)" class="btn btn-danger btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Cart Section -->
    <section id="cart" class="cart-section">
        <div class="cart-container">
            <div class="cart-grid">
                <!-- Cart Items -->
                <div class="cart-items">
                    <div id="cart-items">
                        <div class="empty-state">
                            <div class="empty-icon">üõí</div>
                            <p class="empty-message">Your cart is empty</p>
                            <p class="empty-submessage">Add some products to get started!</p>
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="order-summary">
                    <h3 class="order-summary-title">Order Summary</h3>
                    <div class="order-summary-line">
                        <span>Subtotal:</span>
                        <span id="subtotal">‚Çπ0</span>
                    </div>
                    <div class="order-summary-line" style="color: #059669;">
                        <span>Shipping:</span>
                        <span>FREE</span>
                    </div>
                    <div class="order-summary-line order-summary-total">
                        <span>Total:</span>
                        <span id="total">‚Çπ0</span>
                    </div>
                    <button id="checkout-btn" onclick="checkout()" class="checkout-btn" disabled>
                        Proceed to Checkout
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Modal -->
    <div id="success-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-icon">üéâ</div>
            <h3 class="modal-title">Order Placed Successfully!</h3>
            <p class="modal-message">Thank you for shopping with KickNHit. Your order will be delivered soon!</p>
            <button onclick="closeModal()" class="btn btn-primary">
                Continue Shopping
            </button>
        </div>
    </div>


    <script>
        let cart = [];
        let allProducts = { cricket: [], football: [] };
        let allProductsFlat = [];
        
        // Hardcoded products (Featured and Sale items)
        const hardcodedProducts = [
            // Featured Products
            {
                _id: 'featured-bat',
                name: 'Professional Cricket Bat Pro',
                description: 'Premium English willow, used by international players',
                price: 4999,
                category: 'cricket',
                image: 'https://admin.thecricketer.com/weblab/sites/96c8b790-b593-bfda-0ba4-ecd3a9fdefc2/resources/images/site/kookaburra_nickel_4.1.jpg',
                section: 'featured'
            },
            {
                _id: 'featured-boots',
                name: 'Elite Football Boots',
                description: 'Professional grade boots with advanced grip technology',
                price: 5999,
                category: 'football',
                image: 'https://preview.free3d.com/img/2010/06/1871863703398254318/o29lvvye.jpg',
                section: 'featured'
            },
            {
                _id: 'featured-kit',
                name: 'Complete Cricket Kit',
                description: 'Everything you need: bat, pads, gloves, helmet',
                price: 8999,
                category: 'cricket',
                image: 'https://5.imimg.com/data5/SELLER/Default/2024/6/424095483/DF/VP/RY/163043379/whatsapp-image-2024-06-01-at-3-26-20-pm-500x500.jpeg',
                section: 'featured'
            },
            // Sale Products
            {
                _id: 'sale-pads',
                name: 'Cricket Batting Pads',
                description: 'Professional grade batting pads',
                price: 1199,
                category: 'cricket',
                image: 'https://a2cricket.com/cdn/shop/files/A2Cricket-CricketBattingPads_7_1400x.jpg?v=1690984808',
                section: 'sale'
            },
            {
                _id: 'sale-football',
                name: 'Professional Football',
                description: 'High-quality match football',
                price: 1299,
                category: 'football',
                image: 'https://contents.mediadecathlon.com/p2571328/bcd3c25846279cde8d74b9996aef2566/p2571328.jpg?format=auto&quality=70&f=2520x0',
                section: 'sale'
            },
            {
                _id: 'sale-gloves',
                name: 'Cricket Batting Gloves',
                description: 'Professional batting gloves',
                price: 629,
                category: 'cricket',
                image: 'https://sportsgoodsmarket.com/wp-content/uploads/2020/12/PRO-5-scaled.jpg',
                section: 'sale'
            },
            {
                _id: 'sale-helmet',
                name: 'Cricket Helmet',
                description: 'Protective cricket helmet',
                price: 974,
                category: 'cricket',
                image: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTFFjrb83_2blLq98U-oonOUB3NSU5JaX3-Dw&s',
                section: 'sale'
            }
        ];

        // Load products from API
        async function loadProducts() {
            try {
                const response = await fetch('/api/products');
                const data = await response.json();
                
                if (data.success) {
                    // Organize products by category
                    allProducts.cricket = data.products.filter(p => p.category === 'cricket');
                    allProducts.football = data.products.filter(p => p.category === 'football');
                    allProductsFlat = data.products;
                    
                    // Add hardcoded products to the flat array for search
                    allProductsFlat = [...allProductsFlat, ...hardcodedProducts];
                    
                    // Display current category
                    const currentCategory = document.getElementById('cricket-products').classList.contains('hidden') ? 'football' : 'cricket';
                    displayProducts(currentCategory);
                } else {
                    console.error('Failed to load products:', data.message);
                    // If API fails, at least include hardcoded products for search
                    allProductsFlat = [...hardcodedProducts];
                }
            } catch (error) {
                console.error('Error loading products:', error);
                // If API fails, at least include hardcoded products for search
                allProductsFlat = [...hardcodedProducts];
            }
        }

        function displayProducts(category) {
            const products = allProducts[category];
            
            if (products.length === 0) {
                const container = document.getElementById(`${category}-grid`);
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-icon">üì¶</div>
                        <p class="empty-message">No ${category} products available</p>
                        <p class="empty-submessage">Check back later for new arrivals!</p>
                    </div>
                `;
                return;
            }

            // Decide between grid and carousel view
            if (products.length <= 3) {
                showGridView(category, products);
            } else {
                showCarouselView(category, products);
            }
        }

        function showGridView(category, products) {
            const grid = document.getElementById(`${category}-grid`);
            const carousel = document.getElementById(`${category}-carousel`);
            
            // Show grid, hide carousel
            grid.classList.remove('hidden');
            carousel.classList.add('hidden');
            
            grid.innerHTML = products.map(product => createProductCardHTML(product, false)).join('');
        }

        function showCarouselView(category, products) {
            const grid = document.getElementById(`${category}-grid`);
            const carousel = document.getElementById(`${category}-carousel`);
            const carouselItems = document.getElementById(`${category}-carousel-items`);
            
            // Show carousel, hide grid
            carousel.classList.remove('hidden');
            grid.classList.add('hidden');
            
            carouselItems.innerHTML = products.map(product => createProductCardHTML(product, true)).join('');
        }

        function createProductCardHTML(product, isCarousel = false) {
            // Check if product is newly added (within last 24 hours)
            const isNew = product.createdAt && new Date(product.createdAt) > new Date(Date.now() - 24*60*60*1000);
            
            const cardClass = isCarousel ? 'card carousel-card' : 'card';
            const cardExtraClass = isNew ? ' product-card-new' : '';
            
            const newTag = isNew ? 
                `<div class="new-badge">NEW</div>` : '';

            return `
                <div class="${cardClass}${cardExtraClass}" data-product-id="${product._id}">
                    <div class="card-img-container" style="position: relative;">
                        <img src="${product.image}" 
                             alt="${product.name}" 
                             class="card-img"
                             onerror="this.src='https://via.placeholder.com/300x200?text=Image+Not+Found'">
                        ${newTag}
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">${product.name}</h3>
                        <p class="card-description">${product.description}</p>
                        <div class="card-footer">
                            <span class="card-price">‚Çπ${product.price}</span>
                            <button onclick="addToCart('${product._id}', '${product.name}', ${product.price})" class="btn btn-primary btn-sm">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function scrollCarousel(carouselId, direction) {
            const carousel = document.getElementById(carouselId);
            const cardWidth = 280 + 24; // card width + gap
            const scrollAmount = cardWidth * direction;
            carousel.scrollBy({
                left: scrollAmount,
                behavior: 'smooth'
            });
        }

        function showCategory(category) {
            // Update tab styling
            const cricketTab = document.getElementById('cricket-tab');
            const footballTab = document.getElementById('football-tab');
            
            if (category === 'cricket') {
                cricketTab.classList.add('active');
                footballTab.classList.remove('active');
            } else {
                footballTab.classList.add('active');
                cricketTab.classList.remove('active');
            }

            // Show/hide product sections
            const cricketProducts = document.getElementById('cricket-products');
            const footballProducts = document.getElementById('football-products');
            
            if (category === 'cricket') {
                cricketProducts.classList.remove('hidden');
                footballProducts.classList.add('hidden');
            } else {
                footballProducts.classList.remove('hidden');
                cricketProducts.classList.add('hidden');
            }
            
            // Display products for the selected category
            displayProducts(category);
        }

        // Refresh products periodically to sync with admin changes
        function startProductSync() {
            setInterval(async () => {
                await loadProducts();
            }, 30000); // Refresh every 30 seconds
        }

        function addToCart(id, name, price) {
            const existingItem = cart.find(item => item.id === id);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ id, name, price, quantity: 1 });
            }
            updateCart();
            showNotification(`${name} added to cart!`);
        }

        function removeFromCart(id) {
            cart = cart.filter(item => item.id !== id);
            updateCart();
        }

        function updateQuantity(id, quantity) {
            const item = cart.find(item => item.id === id);
            if (item) {
                item.quantity = Math.max(1, quantity);
                updateCart();
            }
        }

        function updateCart() {
            const cartCount = document.getElementById('cart-count');
            const cartItems = document.getElementById('cart-items');
            const subtotal = document.getElementById('subtotal');
            const total = document.getElementById('total');
            const checkoutBtn = document.getElementById('checkout-btn');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;

            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üõí</div>
                        <p class="empty-message">Your cart is empty</p>
                        <p class="empty-submessage">Add some products to get started!</p>
                    </div>
                `;
                checkoutBtn.disabled = true;
            } else {
                cartItems.innerHTML = `
                    <div class="text-center mb-3">
                        <div class="empty-icon">üõí</div>
                        <h3 class="card-title">View Your Cart</h3>
                        <p class="card-description">Review your selected items</p>
                    </div>
                    ${cart.map(item => `
                        <div class="cart-item">
                            <div class="cart-item-info">
                                <h4 class="cart-item-title">${item.name}</h4>
                                <p class="cart-item-price">‚Çπ${item.price}</p>
                            </div>
                            <div class="cart-item-controls">
                                <button onclick="updateQuantity('${item.id}', ${item.quantity - 1})" class="quantity-btn">-</button>
                                <span class="quantity-display">${item.quantity}</span>
                                <button onclick="updateQuantity('${item.id}', ${item.quantity + 1})" class="quantity-btn">+</button>
                                <button onclick="removeFromCart('${item.id}')" class="remove-btn">Remove</button>
                            </div>
                        </div>
                    `).join('')}
                `;
                checkoutBtn.disabled = false;
            }

            const subtotalAmount = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            subtotal.textContent = `‚Çπ${subtotalAmount}`;
            total.textContent = `‚Çπ${subtotalAmount}`;
        }

        function checkout() {
            if (cart.length === 0) return;

            document.getElementById('success-modal').classList.remove('hidden');
            document.getElementById('success-modal').classList.add('flex');
            cart = [];
            updateCart();
        }

        function closeModal() {
            document.getElementById('success-modal').classList.add('hidden');
            document.getElementById('success-modal').classList.remove('flex');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification success';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // --- Product Search Logic ---
        const searchInput = document.getElementById('product-search');
        const suggestionsBox = document.getElementById('search-suggestions');

        searchInput.addEventListener('input', function() {
            const query = this.value.trim().toLowerCase();
            if (!query) {
                suggestionsBox.style.display = 'none';
                suggestionsBox.innerHTML = '';
                return;
            }
            
            // Enhanced search - look for matches in name, description, and keywords
            const matches = allProductsFlat.filter(p => {
                const name = p.name.toLowerCase();
                const description = p.description.toLowerCase();
                const category = p.category.toLowerCase();
                
                return name.includes(query) || 
                       description.includes(query) || 
                       category.includes(query) ||
                       // Handle common search terms
                       (query.includes('bat') && (name.includes('bat') || name.includes('cricket'))) ||
                       (query.includes('ball') && (name.includes('ball') || name.includes('football'))) ||
                       (query.includes('boot') && name.includes('boot')) ||
                       (query.includes('pad') && name.includes('pad')) ||
                       (query.includes('glove') && name.includes('glove')) ||
                       (query.includes('helmet') && name.includes('helmet')) ||
                       (query.includes('kit') && name.includes('kit'));
            });
            
            // Sort matches by relevance (exact name matches first)
            matches.sort((a, b) => {
                const aNameMatch = a.name.toLowerCase().includes(query);
                const bNameMatch = b.name.toLowerCase().includes(query);
                if (aNameMatch && !bNameMatch) return -1;
                if (!aNameMatch && bNameMatch) return 1;
                return 0;
            });
            
            if (matches.length === 0) {
                suggestionsBox.innerHTML = '<div class="search-no-results">No products found</div>';
                suggestionsBox.style.display = 'block';
                return;
            }
            
            // Limit to 8 results to avoid overwhelming the user
            const limitedMatches = matches.slice(0, 8);
            
            suggestionsBox.innerHTML = limitedMatches.map(p => {
                // Add category badge for better identification
                const categoryBadge = `<span class="search-category-badge">${p.category}</span>`;
                const sectionBadge = p.section ? `<span class="search-section-badge">${p.section}</span>` : '';
                
                return `<div class="search-suggestion-item" data-id="${p._id}">
                    <img src="${p.image}" alt="${p.name}" class="search-suggestion-image" onerror="this.src='https://via.placeholder.com/40x40?text=No+Image'">
                    <div class="search-suggestion-content">
                        <span class="search-suggestion-text">${p.name}</span>
                        <div class="search-suggestion-badges">
                            ${categoryBadge}
                            ${sectionBadge}
                        </div>
                    </div>
                </div>`;
            }).join('');
            suggestionsBox.style.display = 'block';
        });

        suggestionsBox.addEventListener('click', function(e) {
            console.log('Search suggestion clicked:', e.target);
            const item = e.target.closest('.search-suggestion-item');
            console.log('Found suggestion item:', item);
            
            if (item) {
                const productId = item.getAttribute('data-id');
                console.log('Searching for product with ID:', productId);
                
                // Find the product in our loaded products
                const product = allProductsFlat.find(p => p._id === productId);
                console.log('Found product:', product);
                
                if (product) {
                    console.log('Navigating to product:', product.name);
                    navigateToProduct(product);
                    
                    // Clear search input and hide suggestions
                    searchInput.value = '';
                    suggestionsBox.style.display = 'none';
                    suggestionsBox.innerHTML = '';
                } else {
                    console.error('Product not found in allProductsFlat array');
                    console.log('Available products:', allProductsFlat.map(p => ({id: p._id, name: p.name})));
                }
            } else {
                console.log('No suggestion item found for click target');
            }
        });

        // Prevent search input from losing focus when clicking on suggestions
        suggestionsBox.addEventListener('mousedown', function(e) {
            e.preventDefault();
        });

        // Enhanced navigation function to handle all product types
        function navigateToProduct(product) {
            console.log('=== NAVIGATING TO PRODUCT ===');
            console.log('Product:', product);
            
            const productId = product._id;
            
            // Handle hardcoded products (featured/sale)
            if (product.section) {
                console.log('Navigating to hardcoded product - section:', product.section);
                
                // First scroll to the section
                const section = document.querySelector(`#${product.section}`);
                console.log('Section element found:', section);
                
                if (section) {
                    section.scrollIntoView({
                        behavior: 'smooth'
                    });
                    
                    // Wait for scroll to complete, then find and highlight the product
                    setTimeout(() => {
                        highlightProductCard(productId);
                    }, 800);
                } else {
                    console.error('Section not found:', product.section);
                }
            } else {
                console.log('Navigating to API product - category:', product.category);
                
                // Handle API products - first make sure the category is shown
                const currentCategory = product.category;
                const currentActiveTab = document.querySelector('.category-tab.active');
                console.log('Current active tab:', currentActiveTab);
                
                const currentActiveCategory = currentActiveTab ? currentActiveTab.id.replace('-tab', '') : 'cricket';
                console.log('Current active category:', currentActiveCategory);
                
                // If we need to switch categories
                if (currentActiveCategory !== currentCategory) {
                    console.log('Switching category from', currentActiveCategory, 'to', currentCategory);
                    showCategory(currentCategory);
                    
                    // Wait for category switch and product rendering
                    setTimeout(() => {
                        scrollToProductsAndHighlight(productId);
                    }, 1200); // Increased wait time
                } else {
                    console.log('Already on correct category:', currentCategory);
                    // Already on correct category, just scroll and highlight
                    scrollToProductsAndHighlight(productId);
                }
            }
        }

        // Function to scroll to products section and highlight specific product
        function scrollToProductsAndHighlight(productId) {
            // Scroll to products section first
            const productsSection = document.querySelector('#products');
            if (productsSection) {
                productsSection.scrollIntoView({
                    behavior: 'smooth'
                });
            }
            
            // Wait for scroll to complete, then highlight
            setTimeout(() => {
                highlightProductCard(productId);
            }, 800);
        }

        // Function to find and highlight a product card
        function highlightProductCard(productId) {
            console.log('=== HIGHLIGHTING PRODUCT CARD ===');
            console.log('Looking for product ID:', productId);
            
            // Try to find the product card
            let productCard = findProductCard(productId);
            
            if (productCard) {
                console.log('Found product card:', productCard);
                console.log('Product card classes:', productCard.className);
                
                // Add highlight effect
                productCard.classList.add('product-highlight');
                
                // Scroll to the specific product card
                productCard.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                
                // Remove highlight after 3 seconds
                setTimeout(() => {
                    productCard.classList.remove('product-highlight');
                }, 3000);
            } else {
                console.error('Product card not found after all attempts:', productId);
                console.log('Available product cards on page:');
                const allCards = document.querySelectorAll('[data-product-id]');
                allCards.forEach(card => {
                    console.log('- Card ID:', card.getAttribute('data-product-id'), 'Title:', card.querySelector('.card-title')?.textContent);
                });
            }
        }

        // Function to find a product card using multiple strategies
        function findProductCard(productId) {
            console.log('=== FINDING PRODUCT CARD ===');
            console.log('Searching for product ID:', productId);
            
            // Strategy 1: Direct search by data-product-id
            let productCard = document.querySelector(`[data-product-id="${productId}"]`);
            if (productCard) {
                console.log('Found product card using direct search');
                return productCard;
            }
            
            // Strategy 2: Search in all possible containers
            const containers = [
                '#cricket-grid',
                '#cricket-carousel-items',
                '#football-grid', 
                '#football-carousel-items',
                '#featured .product-grid',
                '#sale .flash-sale-grid'
            ];
            
            console.log('Searching in containers:', containers);
            
            for (let container of containers) {
                const containerElement = document.querySelector(container);
                console.log(`Container ${container}:`, containerElement);
                
                if (containerElement) {
                    productCard = containerElement.querySelector(`[data-product-id="${productId}"]`);
                    if (productCard) {
                        console.log('Found product card in container:', container);
                        return productCard;
                    }
                }
            }
            
            // Strategy 3: Search by product name (fallback)
            const product = allProductsFlat.find(p => p._id === productId);
            if (product) {
                console.log('Attempting name-based search for:', product.name);
                const allCards = document.querySelectorAll('.card');
                console.log('Total cards found:', allCards.length);
                
                for (let card of allCards) {
                    const titleElement = card.querySelector('.card-title');
                    if (titleElement) {
                        const cardTitle = titleElement.textContent.trim();
                        console.log('Comparing:', cardTitle, 'vs', product.name);
                        
                        if (cardTitle === product.name) {
                            console.log('Found product card by name match');
                            return card;
                        }
                    }
                }
            }
            
            console.log('Product card not found with any strategy');
            return null;
        }

        // Hide suggestions on blur (with delay to allow clicks)
        searchInput.addEventListener('blur', function() {
            // Increased delay to ensure click events are processed
            setTimeout(() => { 
                suggestionsBox.style.display = 'none';
                suggestionsBox.innerHTML = ''; 
            }, 300);
        });

        // Show suggestions on focus if there's a value
        searchInput.addEventListener('focus', function() {
            if (this.value.trim()) {
                // Trigger input event to show suggestions
                this.dispatchEvent(new Event('input'));
            }
        });

        // Clear search on Escape key and add arrow key navigation
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                this.value = '';
                suggestionsBox.style.display = 'none';
                suggestionsBox.innerHTML = '';
                return;
            }
            
            // Handle arrow key navigation
            const suggestions = suggestionsBox.querySelectorAll('.search-suggestion-item');
            if (suggestions.length === 0) return;
            
            const currentActive = suggestionsBox.querySelector('.search-suggestion-item.active');
            let currentIndex = currentActive ? Array.from(suggestions).indexOf(currentActive) : -1;
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                currentIndex = (currentIndex + 1) % suggestions.length;
                updateActiveSearchItem(suggestions, currentIndex);
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                currentIndex = currentIndex <= 0 ? suggestions.length - 1 : currentIndex - 1;
                updateActiveSearchItem(suggestions, currentIndex);
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (currentActive) {
                    currentActive.click();
                } else if (suggestions.length > 0) {
                    suggestions[0].click();
                }
            }
        });
        
        // Function to update active search item
        function updateActiveSearchItem(suggestions, activeIndex) {
            suggestions.forEach((item, index) => {
                if (index === activeIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function () {
            console.log('=== PAGE INITIALIZATION ===');
            console.log('Loading products...');
            
            await loadProducts(); // Load products from API
            
            console.log('Products loaded. Total products:', allProductsFlat.length);
            console.log('All products:', allProductsFlat.map(p => ({id: p._id, name: p.name, category: p.category, section: p.section})));
            
            showCategory('cricket'); // Show cricket products by default
            startProductSync(); // Start periodic sync
            
            // Debug: Log all product cards found on page
            console.log('=== DEBUG: ALL PRODUCT CARDS ON PAGE ===');
            setTimeout(() => {
                const allCards = document.querySelectorAll('[data-product-id]');
                console.log('Total product cards found:', allCards.length);
                allCards.forEach(card => {
                    console.log('- Card ID:', card.getAttribute('data-product-id'), 'Title:', card.querySelector('.card-title')?.textContent);
                });
            }, 1000);
        });
    </script>
</body>

</html>
